<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>ğŸ§¨ æ–°æ˜¥ç´…åŒ…æŠ½æŠ½æ¨‚</title>
    <meta property="og:title" content="æ–°æ˜¥ç´…åŒ…æŠ½æŠ½æ¨‚">
    <meta property="og:description" content="é»æ“Šç´…åŒ…æŠ½å¤§çï¼Œçœ‹çœ‹ä½ ä»Šå¹´çš„å¥½é‹æ•¸å­—ï¼">
    <meta property="og:type" content="website">

    <style>
        body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: #8b0000; touch-action: none;
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
        }
        canvas { display: block; }
        
        #intro {
            position: absolute; top: 20%; left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700; font-size: 24px; font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none; text-align: center;
            z-index: 10; width: 100%;
        }

        /* LINE åˆ†äº«æŒ‰éˆ• */
        #shareBtn {
            display: none;
            position: absolute; bottom: 40px; left: 50%;
            transform: translateX(-50%);
            background-color: #06C755; color: white;
            border: none; padding: 15px 35px;
            font-size: 18px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            cursor: pointer; z-index: 20;
            font-weight: bold; text-decoration: none;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
            40% {transform: translateX(-50%) translateY(-10px);}
            60% {transform: translateX(-50%) translateY(-5px);}
        }
    </style>
</head>
<body>

<div id="intro">ğŸ§§ é»æ“Šç´…åŒ…è©¦è©¦æ‰‹æ°£ ğŸ§§</div>
<button id="shareBtn" onclick="shareToLine()">å‚³é€çµæœçµ¦ LINE å¥½å‹</button>
<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const introDiv = document.getElementById('intro');
    const shareBtn = document.getElementById('shareBtn');

    const prizesSource = ['000', '1111', '2222', '666', '222', '111', '88', '888', '66', '6', '8', '87'];
    let boxes = [];
    let particles = [];
    let canvasWidth, canvasHeight;
    let lastPrize = "";

    const COLORS = {
        bg: '#8B0000', cloud: '#A52A2A', redEnv: '#D90000',
        redEnvDark: '#B30000', gold: '#FFD700'
    };

    function init() {
        resize();
        window.addEventListener('resize', resize);
        canvas.addEventListener('click', (e) => handleInput(e.clientX, e.clientY));
        canvas.addEventListener('touchstart', (e) => {
            if(e.target.id === 'shareBtn') return;
            e.preventDefault();
            handleInput(e.touches[0].clientX, e.touches[0].clientY);
        }, {passive: false});

        let shuffledPrizes = [...prizesSource].sort(() => Math.random() - 0.5);
        createBoxes(shuffledPrizes);
        loop();
    }

    function resize() {
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        if (boxes.length > 0) recalcBoxPositions();
    }

    function createBoxes(prizes) {
        boxes = [];
        const cols = 3, rows = 4;
        const marginX = canvasWidth * 0.05, marginY = canvasHeight * 0.1;
        const usableW = canvasWidth - (marginX * 2), usableH = canvasHeight - (marginY * 2);
        const boxW = usableW / cols, boxH = usableH / rows;

        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                const index = r * cols + c;
                boxes.push({
                    r, c, prize: prizes[index], isOpen: false, scale: 1,
                    itemW: boxW * 0.85, itemH: boxH * 0.8
                });
            }
        }
        recalcBoxPositions();
    }

    function recalcBoxPositions() {
        const cols = 3, rows = 4;
        const marginX = canvasWidth * 0.05, marginY = canvasHeight * 0.1;
        const boxW = (canvasWidth - (marginX * 2)) / cols;
        const boxH = (canvasHeight - (marginY * 2)) / rows;

        boxes.forEach(box => {
            box.cx = marginX + (box.c * boxW) + (boxW / 2);
            box.cy = marginY + (box.r * boxH) + (boxH / 2);
            box.x = box.cx - (box.itemW / 2);
            box.y = box.cy - (box.itemH / 2);
        });
    }

    function shareToLine() {
        const gameUrl = window.location.href.split('?')[0]; 
        const message = `ğŸ§§ æ–°æ˜¥å¤§å‰ï¼\næˆ‘åœ¨ç´…åŒ…æŠ½æŠ½æ¨‚ä¸­æŠ½åˆ°äº†æ•¸å­—ï¼šã€${lastPrize}ã€‘ï¼\n\nä½ ä¹Ÿä¾†è©¦è©¦æ‰‹æ°£å§ ğŸ‘‡\n${gameUrl}`;
        window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(message)}`;
    }

    function drawBackground() {
        ctx.fillStyle = COLORS.bg;
        ctx.fillRect(0, 0, canvasWidth, canvasHeight);
        ctx.strokeStyle = COLORS.cloud; ctx.lineWidth = 2;
        ctx.beginPath();
        for (let y = 0; y < canvasHeight; y += 80) {
            for (let x = (y/80)%2*40; x < canvasWidth; x += 80) {
                ctx.arc(x, y, 20, 0, Math.PI, true);
            }
        }
        ctx.stroke();
    }

    function drawEnvelopes() {
        boxes.forEach(box => {
            ctx.save();
            ctx.translate(box.cx, box.cy);
            ctx.scale(box.scale, box.scale);
            ctx.translate(-box.cx, -box.cy);

            if (!box.isOpen) {
                // ç´…åŒ…æœ¬é«”
                ctx.fillStyle = COLORS.redEnv;
                ctx.shadowColor = 'rgba(0,0,0,0.3)'; ctx.shadowBlur = 10;
                ctx.fillRect(box.x, box.y, box.itemW, box.itemH);
                ctx.shadowBlur = 0;

                // åœ“å¼§å°å£
                ctx.fillStyle = COLORS.redEnvDark;
                ctx.beginPath();
                ctx.moveTo(box.x, box.y);
                ctx.quadraticCurveTo(box.cx, box.y + (box.itemH * 0.4), box.x + box.itemW, box.y);
                ctx.fill();

                // é‡‘è‰²ç¦å­—
                ctx.fillStyle = COLORS.gold;
                ctx.beginPath();
                ctx.arc(box.cx, box.cy, box.itemW * 0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = COLORS.redEnv;
                ctx.font = `bold ${box.itemW * 0.25}px serif`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText('ç¦', box.cx, box.cy);
            } else {
                // æ‰“é–‹ç‹€æ…‹
                ctx.fillStyle = '#FFF8E7';
                ctx.fillRect(box.x, box.y, box.itemW, box.itemH);
                ctx.strokeStyle = COLORS.gold; ctx.lineWidth = 4;
                ctx.strokeRect(box.x, box.y, box.itemW, box.itemH);
                ctx.fillStyle = '#D90000';
                ctx.font = `bold ${box.itemW * 0.3}px Arial`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText(box.prize, box.cx, box.cy);
            }
            ctx.restore();
        });
    }

    class Particle {
        constructor(x, y) {
            this.x = x; this.y = y;
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 6 + 2;
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.life = 1.0;
            this.color = `hsl(${Math.random() * 40 + 40}, 100%, 50%)`;
        }
        update() { this.x += this.vx; this.y += this.vy; this.vy += 0.15; this.life -= 0.02; }
        draw() {
            ctx.globalAlpha = this.life; ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2); ctx.fill();
        }
    }

    function handleInput(x, y) {
        introDiv.style.opacity = '0';
        boxes.forEach(box => {
            if (!box.isOpen && x > box.x && x < box.x + box.itemW && y > box.y && y < box.y + box.itemH) {
                box.isOpen = true;
                lastPrize = box.prize;
                for(let i=0; i<30; i++) particles.push(new Particle(x, y));
                shareBtn.style.display = 'block';
            }
        });
    }

    function loop() {
        drawBackground();
        drawEnvelopes();
        particles = particles.filter(p => p.life > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        ctx.globalAlpha = 1;
        requestAnimationFrame(loop);
    }

    init();
</script>
</body>
</html>
